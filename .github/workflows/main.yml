name: .NET Package and Push

on:
  push:
    branches:
      - main

jobs:
  build-and-push:
    runs-on: windows-latest

    steps:
    - uses: actions/checkout@v2

    - name: Setup .NET Core
      uses: actions/setup-dotnet@v1
      with:
        dotnet-version: '6.0' # Replace with your .NET Core version

    - name: Restore dependencies
      run: dotnet restore

    - name: Extract version
      id: project_version
      run: |
        $version = [xml](Get-Content ./OpenAi/OpenAi.csproj).Project.PropertyGroup.Version
        echo "PROJECT_VERSION=$version" >> $GITHUB_ENV
        echo "::set-output name=version::$version"

    - name: Build
      run: dotnet build --configuration Release --no-restore
      
    - name: Pack
      run: dotnet pack --configuration Release

    - name: Push NuGet package
      run: dotnet nuget push "./OpenAiFetcher/bin/Release/OpenAi_Fetcher.${{ steps.project_version.outputs.version }}.nupkg" --api-key ${{ secrets.YOUR_API_KEY_SECRET }} --source "github"
